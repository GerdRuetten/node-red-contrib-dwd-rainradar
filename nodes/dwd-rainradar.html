<script type="text/html" data-template-name="dwd-rainradar">
    <div class="form-row">
        <label for="node-input-name">
            <span data-i18n="dwd-rainradar.label.name"></span>
        </label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]dwd-rainradar.placeholder.name">
    </div>

    <div class="form-row">
        <label for="node-input-mode">
            <span data-i18n="dwd-rainradar.label.mode"></span>
        </label>
        <select id="node-input-mode">
            <option value="de" data-i18n="dwd-rainradar.label.modeDe"></option>
            <option value="bbox" data-i18n="dwd-rainradar.label.modeBbox"></option>
            <option value="point" data-i18n="dwd-rainradar.label.modePoint"></option>
        </select>
    </div>

    <div class="form-row form-row-bbox">
        <label>
            <span data-i18n="dwd-rainradar.label.latMin"></span>
        </label>
        <input type="text" id="node-input-latMin" style="width: 120px;">
        <label style="margin-left: 10px;">
            <span data-i18n="dwd-rainradar.label.latMax"></span>
        </label>
        <input type="text" id="node-input-latMax" style="width: 120px;">
    </div>

    <div class="form-row form-row-bbox">
        <label>
            <span data-i18n="dwd-rainradar.label.lonMin"></span>
        </label>
        <input type="text" id="node-input-lonMin" style="width: 120px;">
        <label style="margin-left: 10px;">
            <span data-i18n="dwd-rainradar.label.lonMax"></span>
        </label>
        <input type="text" id="node-input-lonMax" style="width: 120px;">
    </div>

    <div class="form-row form-row-point">
        <label for="node-input-lat">
            <span data-i18n="dwd-rainradar.label.lat"></span>
        </label>
        <input type="text" id="node-input-lat" style="width: 120px;">
        <label for="node-input-lon" style="margin-left: 10px;">
            <span data-i18n="dwd-rainradar.label.lon"></span>
        </label>
        <input type="text" id="node-input-lon" style="width: 120px;">
    </div>

    <div class="form-row form-row-point">
        <label for="node-input-radius">
            <span data-i18n="dwd-rainradar.label.radius"></span>
        </label>
        <input type="text" id="node-input-radius" style="width: 120px;">
    </div>

    <div class="form-row">
        <label for="node-input-autoRefresh">
            <span data-i18n="dwd-rainradar.label.autoRefresh"></span>
        </label>
        <input type="number" id="node-input-autoRefresh" style="width: 100px;" min="0">
    </div>

    <div class="form-row">
        <label for="node-input-backendUrl">
            <span data-i18n="dwd-rainradar.label.backendUrl"></span>
        </label>
        <input type="text" id="node-input-backendUrl" style="width: 100%;"
               data-i18n="[placeholder]dwd-rainradar.placeholder.backendUrl">
        <p class="form-tips" data-i18n="dwd-rainradar.help.backendUrl"></p>
    </div>

    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-fetchOnDeploy" style="display:inline-block; width:auto; vertical-align:baseline;">
        <label for="node-input-fetchOnDeploy" style="width:auto;" data-i18n="dwd-rainradar.label.fetchOnDeploy"></label>
    </div>

    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-outputSummary" style="display:inline-block; width:auto; vertical-align:baseline;">
        <label for="node-input-outputSummary" style="width:auto;" data-i18n="dwd-rainradar.label.outputSummary"></label>
    </div>

    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-outputGrid" style="display:inline-block; width:auto; vertical-align:baseline;">
        <label for="node-input-outputGrid" style="width:auto;" data-i18n="dwd-rainradar.label.outputGrid"></label>
    </div>

    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-outputImage" style="display:inline-block; width:auto; vertical-align:baseline;">
        <label for="node-input-outputImage" style="width:auto;" data-i18n="dwd-rainradar.label.outputImage"></label>
    </div>

    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-diag" style="display:inline-block; width:auto; vertical-align:baseline;">
        <label for="node-input-diag" style="width:auto;" data-i18n="dwd-rainradar.label.diag"></label>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType("dwd-rainradar", {
        category: "input",
        color: "#4c97ff",
        defaults: {
            name:          { value: "" },
            mode:          { value: "de" },
            latMin:        { value: "" },
            latMax:        { value: "" },
            lonMin:        { value: "" },
            lonMax:        { value: "" },
            lat:           { value: "" },
            lon:           { value: "" },
            radius:        { value: "" },
            autoRefresh:   { value: 0 },
            fetchOnDeploy: { value: true },
            outputSummary: { value: true },
            outputGrid:    { value: true },
            outputImage:   { value: false },
            backendUrl:    { value: "" },
            diag:          { value: false }
        },
        inputs: 1,
        outputs: 1,
        icon: "font-awesome/fa-cloud-rain",
        label: function () {
            if (this.name && this.name.trim() !== "") {
                return this.name;
            }
            // Fallback auf lokalisierten Default-Label-Text
            if (this._ && this._("dwd-rainradar.label.defaultName") !== "dwd-rainradar.label.defaultName") {
                return this._("dwd-rainradar.label.defaultName");
            }
            return "DWD Rain Radar";
        },
        labelStyle: function () {
            return (this.name && this.name.trim() !== "") ? "node-label" : "node-label-italic";
        },
        oneditprepare: function () {
            var $mode = $("#node-input-mode");

            function updateModeVisibility() {
                var mode = $mode.val();
                $(".form-row-bbox").toggle(mode === "bbox");
                $(".form-row-point").toggle(mode === "point");
            }

            $mode.on("change", updateModeVisibility);
            updateModeVisibility();
        }
    });
</script>